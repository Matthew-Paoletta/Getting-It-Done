<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebReg2Cal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="logo">
        <img src="images/icon48.png" alt="WebReg2Cal Logo" class="logo-img">
        <h1>WebReg2Cal</h1>
      </div>
      <p class="tagline">Transform your WebReg schedule into calendar events</p>
    </header>

    <!-- Quarter Selection -->
    <div class="step-card">
      <div class="step-number">1</div>
      <div class="step-content">
        <h2>Select Quarter</h2>
        <div class="quarter-controls">
          <select id="quarter" class="quarter-select">
            <option value="Fall">Fall</option>
            <option value="Winter" selected>Winter</option>
            <option value="Spring">Spring</option>
            <option value="Summer Session 1">Summer Session 1</option>
            <option value="Summer Session 2">Summer Session 2</option>
          </select>
          <select id="year" class="year-select">
            <option value="2026" selected>2026</option>
            <option value="2027">2027</option>
            <option value="2028">2028</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Input Method Toggle -->
    <div class="step-card">
      <div class="step-number">2</div>
      <div class="step-content">
        <h2>Choose Input Method</h2>
        <p>Upload a screenshot or paste text from WebReg</p>
        
        <div class="input-method-toggle">
          <button id="method-text" class="method-btn active">
            üìã Paste Text
          </button>
          <button id="method-image" class="method-btn">
            üì∑ Screenshot
          </button>
        </div>

        <!-- Text Paste Section (NOW FIRST AND VISIBLE BY DEFAULT) -->
        <div id="text-input-section" class="input-section">
          <div class="instructions-box">
            <h3>üìã How to copy your schedule:</h3>
            <ol>
              <li>Go to <a href="https://act.ucsd.edu/webreg2" target="_blank">WebReg</a></li>
              <li>Select the correct quarter and click "Go" to load your schedule</li>
              <li>Click the "List" tab to view your schedule as a table</li>
              <li>Select all the text in your schedule table (Ctrl+A or Cmd+A)</li>
              <li>Copy the selected text (Ctrl+C or Cmd+C)</li>
              <li>Paste it in the box below (Ctrl+V or Cmd+V)</li>
            </ol>
          </div>
          
          <div class="text-paste-area">
            <textarea 
              id="schedule-text" 
              placeholder="Paste your WebReg schedule text here...

Example format:
CSE 100	Advanced Data Structures	A00	LE	Sahoo	MWF	9:00a-9:50a	PETER	108
    A01	DI	W	8:00p-8:50p	PETER	108
    Midterm	MI	Sa 02/07/2026	3:00p-4:50p	PETER	108
    Final Exam	FI	W 03/18/2026	8:00a-10:59a	PETER	108"
              rows="10"></textarea>
            <div id="text-char-count" class="char-count">0 characters</div>
          </div>
          
          <button id="parse-text-btn" class="btn primary" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
            Parse Schedule Text
          </button>
        </div>

        <!-- Image Upload Section (NOW SECOND AND HIDDEN BY DEFAULT) -->
        <div id="image-input-section" class="input-section" style="display: none;">
          <div class="instructions-box">
            <h3>üì∏ How to take the screenshot:</h3>
            <ol>
              <li>Go to <a href="https://act.ucsd.edu/webreg2" target="_blank">WebReg</a></li>
              <li>Select the correct quarter and click "Go" to load your schedule</li>
              <li>Click the "List" tab to view your schedule as a table</li>
              <li>Scroll to see your full list of classes (including all sections)</li>
              <li>Take a screenshot (Win+Shift+S or Cmd+Shift+4)</li>
              <li>Make sure all classes, sections, times and locations are visible</li>
            </ol>
          </div>
          
          <div class="upload-area" id="upload-area">
            <input type="file" id="schedule-upload" accept="image/*" hidden>
            <button id="upload-btn" class="btn primary">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
              Upload Schedule Screenshot
            </button>
            <div id="file-info" style="display: none;">
              <span id="upload-status"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Step 2: Process Image (only shown for image method) -->
    <div class="step-card" id="process-step">
      <div class="step-number">3</div>
      <div class="step-content">
        <h2>Process Schedule</h2>
        <p>Extract class information from your screenshot</p>
        <div id="preview-area"></div>
        <div id="ocr-progress"></div>
        <button id="process-btn" class="btn primary" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="16 12 12 8 8 12"></polyline><line x1="12" y1="16" x2="12" y2="8"></line></svg>
          Analyze Schedule
        </button>
      </div>
    </div>
    
    <!-- Step 3: Results -->
    <div id="result-area"></div>

    <!-- Footer -->
    <footer>
      <p>Made with ‚ù§Ô∏è at UCSD</p>
      <p class="version">Version 1.4</p>
    </footer>
  </div>

  <!-- Edit Event Modal -->
  <div id="edit-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚úèÔ∏è Edit Event</h3>
        <button id="modal-close-btn" class="modal-close">√ó</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="edit-event-index">
        
        <div class="form-group">
          <label>Course Code</label>
          <input type="text" id="edit-course-code" class="form-input" readonly>
        </div>
        
        <div class="form-group">
          <label>Session Type</label>
          <select id="edit-session-type" class="form-input">
            <option value="Lecture">Lecture</option>
            <option value="Discussion">Discussion</option>
            <option value="Lab">Lab</option>
            <option value="Final Exam">Final Exam</option>
            <option value="Midterm">Midterm</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Days (select all that apply)</label>
          <div class="day-checkboxes" id="edit-days-checkboxes">
            <label class="day-checkbox"><input type="checkbox" value="M"> M</label>
            <label class="day-checkbox"><input type="checkbox" value="Tu"> Tu</label>
            <label class="day-checkbox"><input type="checkbox" value="W"> W</label>
            <label class="day-checkbox"><input type="checkbox" value="Th"> Th</label>
            <label class="day-checkbox"><input type="checkbox" value="F"> F</label>
            <label class="day-checkbox"><input type="checkbox" value="Sa"> Sa</label>
            <label class="day-checkbox"><input type="checkbox" value="Su"> Su</label>
          </div>
        </div>
        
        <div class="form-group form-row">
          <div class="form-col">
            <label>Start Time</label>
            <select id="edit-start-time" class="form-input"></select>
          </div>
          <div class="form-col">
            <label>End Time</label>
            <select id="edit-end-time" class="form-input"></select>
          </div>
        </div>
        
        <div class="form-group form-row">
          <div class="form-col">
            <label>Building</label>
            <input type="text" id="edit-building" class="form-input" placeholder="e.g., PETER">
          </div>
          <div class="form-col">
            <label>Room</label>
            <input type="text" id="edit-room" class="form-input" placeholder="e.g., 108">
          </div>
        </div>
        
        <div class="form-group">
          <label>Instructor</label>
          <input type="text" id="edit-instructor" class="form-input" placeholder="e.g., Smith, John">
        </div>
        
        <div class="form-group" id="exam-date-group" style="display: none;">
          <label>Exam Date</label>
          <input type="date" id="edit-exam-date" class="form-input">
        </div>
      </div>
      <div class="modal-footer">
        <button id="modal-delete-btn" class="btn danger">üóëÔ∏è Delete</button>
        <button id="modal-cancel-btn" class="btn secondary">Cancel</button>
        <button id="modal-save-btn" class="btn primary">Save Changes</button>
      </div>
    </div>
  </div>

  <script type="module" src="scripts/popup.js"></script>
</body>
</html>